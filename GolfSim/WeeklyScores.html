<html></html>
    <head>
        <title>Weekly Scores</title>
        
        <style>
            .header{
                font-size: 25px;
                font-weight: bold;
            }
            .hour{
                background-color: #DDD;
            }
            .hourAlt{
                background-color: #EEE;
            }
            .dayCell{
                border-left: 1px solid black;
            }
            .courseHeader{
                text-align: center;
                font-size: 20px;
                font-weight: bold;
                border-bottom: 1px solid black;
                border-top: 2px solid black;
            }
            .holeRow{
                background-color: #000 !important;
                color:white !important;
            }
            .Gold{
                background-color: gold !important;
                font-weight: bold;
            }
            .Blue{
                background-color: blue;
                font-weight: bold;
            }
            .parRow{
                background-color: #000  !important;
                color: white  !important;
                
            }
            .handicapRow{
                background-color: #AAA;
            }

            .briancondor{
                animation-duration: 1s;
                animation-name: brian-condor;
                animation-iteration-count: infinite;
            }

            
            .condor{
                background-color: #0F0 !important;
            }
            .eagle{
                background-color: #0C0 !important;
            }
            .birdie{
                background-color: #0A0 !important;
            }
            .par{
                
                background-color: white !important;
            }
            .bogie{
                color:white  !important;
                background-color: #F00 !important;
            }
            .doubleBogie{
                color:white  !important;
                background-color: #C00 !important;
            }
            .tripleBogie{
                color:white  !important;
                background-color: #A00 !important;
            }
            .quadBogie{
                color:white  !important;
                background-color: #700 !important;
            }
            .quintBogie{
                color:white  !important;
                background-color: #400 !important;
            }
            .courseDataRow{
                border-bottom: 4px solid black;
            }
            .course{
                font-size: 25px;
            }


            @keyframes Bir {
                25%{
                    background-color: blue;
                }
                50%             
                {
                    background-color: red;
                }

                75% 
                {
                    
                    background-color: white;
                }
                100%{
                    background-color: purple;
                }
            }


        </style>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="container" id="navbarContainer"></div>
            
        <div class="container-lg">
            <div class="row">
                <div class="col-2">
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" style="width: 100%;" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Course
                          </button>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <a class="dropdown-item" href="WeeklyScores.html?week=1">Week 1 @ Colonial Country Club</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=2">Week 2 @ Lone Wolf Golf Club</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=3">Week 3 @ Coeur dAlene Golf Resort</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=4">Week 4 @ Hanauma Cliffs</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=5">Week 5 @ Birdsfoot Golf Club</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=6">Week 6 @ The Pete Dye Course at French Lick</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=7">Week 7 @ Pete Dye River Course</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=8">Week 8 @ Hidden Shoals</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=9">Week 9 @ Pebble Beach Golf Links</a>
                            <a class="dropdown-item" href="WeeklyScores.html?week=10">Week 10 @ Crans-sur-Sierre Golf Club</a>
                        </div>
                    </div>
                </div>
                <div class="col-9">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1" onclick="displayScoreType()" checked>
                        <label class="form-check-label" for="inlineRadio1">Raw Scores</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2" onclick="displayScoreType()">
                        <label class="form-check-label" for="inlineRadio2">Net Scores</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3"onclick="displayScoreType()">
                        <label class="form-check-label" for="inlineRadio3">Both Scores</label>
                      </div>
                </div>
                <div class="col-1">
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Order by
                        </button>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                          <a class="dropdown-item" onclick="order(0)">First Name</a>
                          <a class="dropdown-item" onclick="order(1)">Last Name</a>
                          <a class="dropdown-item" onclick="order(2)">Total Score</a>
                          <a class="dropdown-item" onclick="order(3)">Net Score</a>
                        </div>
                      </div>
                </div>
                
            </div>
            <div class="row" id="courseData"></div>
            <table class="table" style="text-align: center;";>
                <thead id="tableHead"></thead>
                <tbody id="tableBody"></tbody>
                <tfoot id="tableFoot"></tfoot>
            </table>
        </div>
    </body>
</html>
<script src="./JS/navbar.js"></script>
<script src="JS/WeeklyReportData.js"></script>

<script>
    window.onload = createNavBar();
    
    let displayType = 0;
    function cleanElement(name){
        let el = document.getElementById(name);
        el.innerHTML = "";
    }

    function clearTable(){
        
        cleanElement("courseData");
    }

    function displayScoreType(){
        cleanElement("tableHead");
        cleanElement("tableBody");
        cleanElement("tableFoot");
        let raw = document.getElementById("inlineRadio1");
        let net = document.getElementById("inlineRadio2");
        let both = document.getElementById("inlineRadio3");
        
        if (raw.checked) displayType = 0;
        if (net.checked) displayType = 1;
        if (both.checked) displayType = 2;
        
        CreateTable(weekData);
    }

    function order(n){
        cleanElement("tableHead");
        cleanElement("tableBody");
        cleanElement("tableFoot");
        let reports = weekData.scoreReports;
        console.log(reports);
        if (n == 0){
            reports.sort((a,b) => (a.firstName > b.firstName) ? 1 : ((b.firstName > a.firstName) ? -1 : 0))
        } else if (n == 1){
            reports.sort((a,b) => (a.lastName > b.lastName) ? 1 : ((b.lastName > a.lastName) ? -1 : 0))
        } else if (n == 2){
            reports.sort((a,b) => a.total - b.total);
        } else if (n == 3){
            reports.sort((a,b) => a.netTotal - b.netTotal);
        }
        CreateTable(weekData);
    }

    function CalculateCourseHandicap(playerHandicap, Par, Rating, Slope){
        return playerHandicap * (Slope/113) (Par-Rating)
    }

    

    

    function CreateButton(i){
        let div = document.createElement("div");
        div.classList.add("col")
        let button = document.createElement("button");
        button.innerText = "Week " + i;
        button.classList.add("btn")
        button.classList.add("btn-primary");
        button.addEventListener("click", () => {
            clearTable();
            CreateCourseData(data[i]);
            CreateTable(data[i]);
        })
        div.appendChild(button);
        return div;
    }

    function CreateButtons(){
        /*let row = document.getElementById("buttonRow");
        for(var i = 1; i <= 10; i++){
            row.appendChild(CreateButton(i));
        }*/
    }

    function CreateHeaderCell(d){
        let cell = document.createElement("td");
        cell.innerText = d;
        return cell;
    }
    function CreateHeaderRow(d, name, css){
        let row = document.createElement("tr");
        row.classList.add(css);
        let buffer = document.createElement("th");
        buffer.innerText = name;
        row.appendChild(buffer);
        d.forEach((p) => {
            row.appendChild(CreateHeaderCell(p));
        });
        return row;
    }

    function CreateScoreCell(d, a, par){
        let cell = document.createElement("td");
        cell.style = "padding: 0px;";
        
        let rawScore = document.createElement("div");
        rawScore.classList.add("span2")
        //rawScore.style = "border-bottom: 1px solid black;"
        rawScore.innerText = d;
        rawScore.classList.add(GetScoreColor(d, par));

        
        let adjScore = document.createElement("div");
        adjScore.innerText = a;
        adjScore.classList.add(GetScoreColor(a, par));
        if (displayType == 0){
            cell.appendChild(rawScore);        
        } else if (displayType == 1){
            cell.appendChild(adjScore);
        } else {
            cell.appendChild(rawScore);        
            cell.appendChild(adjScore);
        }
        
        
        
        return cell;
    }

    function CreateScoreRow(d, pars, handicap){
        let row = document.createElement("tr");
        row.style = "border-bottom: 2px solid black;"
        let nameCell = document.createElement("td");
        if (displayType == 0){
            nameCell.innerHTML = "<div>" + d.player.firstName[0] + " " + d.player.lastName + "</div>";
        } else if (displayType == 1){
            nameCell.innerHTML = "<div>" + d.player.firstName[0] + " " + d.player.lastName + "(" + d.player.handicap + ")</div>";
        } else {
            nameCell.innerHTML = "<div>" + d.player.firstName + " " + d.player.lastName + "</div><div> Handicap: " + d.player.handicap + "</div>";
        }
        
        nameCell.style = "padding: 0px";
        
        row.appendChild(nameCell);
        let total = 0;
        let adjTotal = 0;
        for (var i = 0; i < d.scores.length; i++){
            total+=d.scores[i];
            let adj = findHandicapAdjustment(handicap[i], d.player.handicap);
            let adjustedScore = Math.round((d.scores[i] - adj) * 10) / 10;
            adjTotal+=adjustedScore;
            row.appendChild(CreateScoreCell(d.scores[i], adjustedScore, pars[i]));
        }
            
        
        row.appendChild(CreateScoreCell(Math.round(total * 10) / 10, Math.round(adjTotal * 10) / 10));
        return row;
    }

    function GetScoreColor(score, par){
        let diff = Math.floor(score-par);
        switch (diff){
            case 0: return "par";
            case -1: return "birdie";
            case -2: return "eagle";
            case -3: return "condor";
            case 1: return "bogie";
            case 2: return "doubleBogie";
            case 3: return "tripleBogie";
            case 4: return "quadBogie";
            case 5: return "quintBogie";
        }
    }

    function findHandicapAdjustment(index, handicap){
        let adjustment = 0;
        if (handicap > 0){
             adjustment = Math.floor(handicap / 18) ;
            if((handicap % 18) >= index) adjustment += 1;
        } else if (handicap < 0){
            if((18+handicap % 18) < index) adjustment -=1;
        }
        return adjustment;
    }

    

    function CreateTable(d){
        let tableHeader = document.getElementById("tableHead");
        let tableBody = document.getElementById("tableBody");
        let tableFooter = document.getElementById("tableFoot");

        let holes = [];
        for(var i = 0; i < 18; i++){ holes.push(i+1); }

        tableHeader.appendChild(CreateHeaderRow(holes, "Hole", "holeRow"));
        tableHeader.appendChild(CreateHeaderRow(d.yardages, "Length", d.teeBox.name));
        
        
        d.scoreReports.forEach((s) => {
            tableBody.appendChild(CreateScoreRow(s, d.pars, d.indexes))
        });

        tableHeader.appendChild(CreateHeaderRow(d.pars, "Par", "parRow"));
        tableHeader.appendChild(CreateHeaderRow(d.indexes, "Handicap", "handicapRow"));
        if (displayType != 1){
            tableFooter.appendChild(CreateHeaderRow(d.overs, "Total Over", "handicapRow"));
            tableFooter.appendChild(CreateHeaderRow(d.totals, "Total Strokes", "handicapRow"));
            tableFooter.appendChild(CreateHeaderRow(d.difficulty, "Our Handicap", "handicapRow"));
        }

    }

    function CreateDataCell(d, size){
        let cell = document.createElement("div");
        cell.classList.add(size);
        cell.classList.add("course");
        cell.innerText = d;
        return cell;
    }

    function CreateCourseData(d){
        let row = document.getElementById("courseData");
        row.classList.add("row");
        row.classList.add("courseDataRow");
        row.appendChild(CreateDataCell(d.course.name, "col-4"));
        row.appendChild(CreateDataCell(d.teeBox.name + " Tees", "col-2"));
        row.appendChild(CreateDataCell("Par " + d.teeBox.par, "col-2"));
        row.appendChild(CreateDataCell(d.teeBox.length + " yards", "col-2"));
        row.appendChild(CreateDataCell(d.teeBox.rating + "/" + d.teeBox.slope, "col-2"));
        
    }

    class holeDifficulty{
        constructor(hole, total, over, par, yardage){
            this.Hole = hole;
            this.Total = total;
            this.Over = over;
            this.Par = par;
            this.Yardage = yardage;
            this.Difficulty = 0;
        }

    }


    function formatData(d){

    }

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const week = urlParams.get('week');
    
    let weekData = data[week];

    
    let TotalArr = [];
    for(var i = 0; i < 18; i++){
        TotalArr.push(new holeDifficulty(i+1, 0, 0, data[week].pars[i], data[week].yardages[i]))
    }
    
    data[week].scoreReports.forEach((s) => {
        console.log(s)
        if (s.scores.length == 18){
            for (var i = 0; i < 18; i++) {
                TotalArr[i].Total += s.scores[i];
                TotalArr[i].Over += (s.scores[i] - data[week].pars[i]);
            }
        }
    });

    TotalArr.sort((a, b) => {
        return a.Over - b.Over;
    });

    let diffOrder = 18;
    TotalArr.forEach((t) => {
        t.Difficulty = diffOrder;
        diffOrder--;
    });
    TotalArr.sort((a, b) => {
        return a.Hole - b.Hole;
    });


    let overs = [];
    let totals = [];
    let difficulty = []
    TotalArr.forEach((t) => {
        overs.push(Math.round(t.Over * 10) / 10);
        totals.push(Math.round(t.Total * 10) / 10);
        difficulty.push(t.Difficulty);
    });

    //addSortdata
    weekData.scoreReports.forEach((r) => {
        r.firstName = r.player.firstName;
        r.lastName = r.player.lastName;
        let sum = 0;
        r.scores.forEach((s) => {
            sum += s;
        });
        r.total = sum;
        r.netTotal = sum - r.player.handicap
    });
    
    
    weekData.overs = overs;
    weekData.difficulty = difficulty;
    weekData.totals = totals;
    console.log(weekData)

    CreateCourseData(weekData);
    CreateTable(weekData);
    CreateButtons();

</script>

